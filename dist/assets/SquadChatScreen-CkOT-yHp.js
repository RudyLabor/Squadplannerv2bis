import{c as A,r as n,A as E,j as r,V as $,m as g}from"./index-D_HhqbxM.js";import{I as W}from"./input-CcRrkoAc.js";import{I as D}from"./ImageWithFallback-C-S-nwbk.js";import{u as F}from"./useHaptic-BhqY_yQP.js";import{b as O}from"./mockData-CmE002oF.js";import{A as z}from"./arrow-left-CFku1NrH.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=A("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=A("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);function X({onNavigate:R,showToast:y,useMockData:u,data:o}){const h=(o==null?void 0:o.squadId)||"squad-1",L=(o==null?void 0:o.squadName)||"Les ConquÃ©rants",[l,f]=n.useState([]),[c,v]=n.useState(""),[w,j]=n.useState(!1),[N,I]=n.useState(null),b=n.useRef(null),{selection:k}=F();n.useEffect(()=>{if(u===!0){f(O),setTimeout(q,100);return}u===!1&&h&&V()},[h,u]);const V=async()=>{if(!u)try{const{messages:e}=await E.getMessages(h);f(e||[]),setTimeout(q,100)}catch(e){console.error("Load messages error:",e)}},d="user-1";n.useEffect(()=>{var e;(e=b.current)==null||e.scrollIntoView({behavior:"smooth"})},[l]);const S=async()=>{if(c.trim()){if(k(),u){const e={id:`msg-${Date.now()}`,userId:d,userName:"Vous",userAvatar:"https://api.dicebear.com/7.x/avataaars/svg?seed=You",content:c.trim(),type:"text",timestamp:new Date().toISOString(),reactions:[],isCurrentUser:!0};f([...l,e]),v(""),y("Message envoyÃ©","success");return}j(!0);try{const{message:e}=await E.sendMessage(h,c.trim());f([...l,e]),v(""),y("Message envoyÃ©","success")}catch(e){console.error("Send message error:",e),y(e.message||"Erreur lors de l'envoi","error")}finally{j(!1)}}},M=(e,i)=>{k(),f(l.map(s=>{var a,m;return s.id!==e?s:((a=s.reactions)==null?void 0:a.find(t=>t.userId===d&&t.emoji===i))?{...s,reactions:(m=s.reactions)==null?void 0:m.filter(t=>!(t.userId===d&&t.emoji===i))}:{...s,reactions:[...s.reactions||[],{userId:d,userName:"RudyFourcade",emoji:i}]}})),I(null)},P=e=>{const i=new Date(e),x=new Date().getTime()-i.getTime(),a=Math.floor(x/36e5);return a<1?`Il y a ${Math.floor(x/6e4)}min`:a<24?`Il y a ${a}h`:i.toLocaleDateString("fr-FR",{day:"numeric",month:"short"})},T=["ðŸ‘","â¤ï¸","ðŸ”¥","ðŸ˜‚","ðŸŽ®","âœ…"],q=()=>{var e;(e=b.current)==null||e.scrollIntoView({behavior:"smooth"})};return r.jsxs("div",{className:"min-h-screen pb-0 pt-safe flex flex-col",children:[r.jsx("div",{className:"px-4 py-4 bg-white border-b-[0.5px] border-[var(--border-subtle)] flex-shrink-0",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("button",{onClick:()=>R("squad-detail",{id:h}),className:"w-10 h-10 rounded-2xl bg-[var(--bg-base)] border-[0.5px] border-[var(--border-medium)] flex items-center justify-center hover:border-[var(--border-strong)] transition-all",children:r.jsx(z,{className:"w-5 h-5 text-[var(--fg-primary)]",strokeWidth:2})}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h1",{className:"text-lg font-semibold text-[var(--fg-primary)] tracking-tight",children:L}),r.jsx("p",{className:"text-xs text-[var(--fg-tertiary)]",children:"Chat de squad"})]})]})}),r.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-6 space-y-4",children:[r.jsx($,{initial:!1,children:l.map((e,i)=>{var m;const s=e.userId===d,x=e.type!=="text",a=!s&&!x&&(i===0||l[i-1].userId!==e.userId);return x?r.jsx(g.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex justify-center",children:r.jsx("div",{className:"bg-[var(--bg-muted)] rounded-2xl px-4 py-2 max-w-[85%]",children:r.jsx("p",{className:"text-xs text-[var(--fg-tertiary)] text-center",children:e.content})})},e.id):r.jsxs(g.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex gap-2 ${s?"flex-row-reverse":"flex-row"}`,children:[a&&!s&&r.jsx("div",{className:"w-8 h-8 rounded-full overflow-hidden flex-shrink-0 ring-2 ring-white",children:r.jsx(D,{src:e.userAvatar,alt:e.userName,className:"w-full h-full object-cover"})}),!a&&!s&&r.jsx("div",{className:"w-8"}),r.jsxs("div",{className:`flex flex-col gap-1 max-w-[75%] ${s?"items-end":"items-start"}`,children:[r.jsxs("div",{className:"relative group",children:[r.jsxs("div",{className:`max-w-[75%] rounded-2xl px-4 py-3 ${s?"bg-gradient-to-br from-[var(--primary-500)] to-[var(--primary-600)] text-white shadow-md":"bg-white border-[0.5px] border-[var(--border-subtle)] text-[var(--fg-primary)]"}`,children:[!s&&a&&r.jsx("p",{className:"text-xs font-semibold mb-1 opacity-70",children:e.userName}),r.jsx("p",{className:"text-sm leading-relaxed break-words",children:e.content})]}),r.jsx("button",{onClick:()=>I(N===e.id?null:e.id),className:`absolute ${s?"left-0":"right-0"} top-1/2 -translate-y-1/2 ${s?"-translate-x-10":"translate-x-10"} w-7 h-7 rounded-full bg-white border-[0.5px] border-[var(--border-medium)] shadow-sm flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all hover:scale-110`,children:r.jsx(U,{className:"w-4 h-4 text-[var(--fg-tertiary)]",strokeWidth:2})})]}),r.jsx($,{children:N===e.id&&r.jsx(g.div,{initial:{opacity:0,scale:.9,y:-5},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:-5},className:"bg-white rounded-2xl shadow-lg border-[0.5px] border-[var(--border-subtle)] p-2 flex gap-1",children:T.map(t=>r.jsx("button",{onClick:()=>M(e.id,t),className:"w-9 h-9 rounded-xl hover:bg-[var(--bg-muted)] transition-all flex items-center justify-center text-lg",children:t},t))})}),((m=e.reactions)==null?void 0:m.length)>0&&r.jsx("div",{className:"flex gap-1 flex-wrap",children:Object.entries(e.reactions.reduce((t,p)=>(t[p.emoji]=(t[p.emoji]||0)+1,t),{})).map(([t,p])=>r.jsxs("button",{onClick:()=>M(e.id,t),className:`px-2 py-1 rounded-full text-xs flex items-center gap-1 transition-all ${e.reactions.some(C=>C.userId===d&&C.emoji===t)?"bg-[var(--primary-100)] border-[0.5px] border-[var(--primary-500)]":"bg-[var(--bg-muted)] border-[0.5px] border-transparent hover:border-[var(--border-medium)]"}`,children:[r.jsx("span",{children:t}),r.jsx("span",{className:"text-[var(--fg-secondary)] font-medium",children:p})]},t))}),r.jsx("p",{className:"text-xs text-[var(--fg-tertiary)] px-1",children:P(e.timestamp)})]})]},e.id)})}),r.jsx("div",{ref:b})]}),r.jsx("div",{className:"px-4 py-4 bg-white border-t-[0.5px] border-[var(--border-subtle)] flex-shrink-0 pb-safe",children:r.jsxs("div",{className:"flex items-end gap-2",children:[r.jsx("div",{className:"flex-1",children:r.jsx(W,{value:c,onChange:e=>v(e.target.value),onKeyDown:e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),S())},placeholder:"Votre message...",className:"rounded-2xl resize-none",rows:1})}),r.jsx("button",{onClick:S,disabled:!c.trim()||w,className:`w-11 h-11 rounded-2xl flex items-center justify-center transition-all duration-200 flex-shrink-0 shadow-lg ${c.trim()&&!w?"bg-gradient-to-br from-[var(--primary-500)] to-[var(--primary-600)] hover:from-[var(--primary-600)] hover:to-[var(--primary-700)] text-white shadow-[var(--primary-500)]/20 hover:shadow-xl hover:shadow-[var(--primary-500)]/30 active:scale-95":"bg-[var(--bg-muted)] text-[var(--fg-tertiary)] cursor-not-allowed shadow-none"}`,children:r.jsx(K,{className:"w-5 h-5",strokeWidth:2})})]})})]})}export{X as SquadChatScreen,X as default};
