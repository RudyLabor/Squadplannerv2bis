import{r as o,j as e,m,J as F,z as S,I as q}from"./index-D_HhqbxM.js";import{B as J}from"./button-LWl2mh07.js";import{a as G}from"./mockData-CmE002oF.js";import{u as D}from"./useHaptic-BhqY_yQP.js";import{u as O,C as T}from"./useSoundEffects-DrNcZ70x.js";import{I as X}from"./ImageWithFallback-C-S-nwbk.js";import{E as K}from"./external-link-BFP7DVOa.js";import{G as Q}from"./gamepad-2-hq8iF7Kb.js";import{M as Y}from"./message-circle-CwYZiA0O.js";import{T as Z}from"./triangle-alert-BstlP3N3.js";import{A as ee}from"./arrow-left-CFku1NrH.js";import{C as N}from"./clock-CJ_fTx8V.js";import{C as E}from"./circle-check-big-B3sZbBy8.js";function M({type:u,label:l,deepLink:v,fallbackUrl:s,icon:x,variant:t="primary",className:b=""}){const[a,h]=o.useState(!1),f=()=>{h(!0);const d=document.createElement("iframe");d.style.display="none",d.src=v,document.body.appendChild(d);const c=setTimeout(()=>{s&&window.open(s,"_blank"),document.body.removeChild(d),h(!1)},2500),g=()=>{document.hidden&&(clearTimeout(c),document.body.removeChild(d),h(!1),document.removeEventListener("visibilitychange",g))};document.addEventListener("visibilitychange",g)},p=()=>{if(x)return x;switch(u){case"discord":return e.jsx(Y,{className:"w-5 h-5",strokeWidth:2});case"game":return e.jsx(Q,{className:"w-5 h-5",strokeWidth:2});default:return e.jsx(K,{className:"w-5 h-5",strokeWidth:2})}},y=t==="primary"?"bg-[var(--primary-500)] text-white hover:bg-[var(--primary-600)] shadow-[0_4px_16px_rgba(245,158,11,0.25)]":"bg-white text-[var(--fg-primary)] border-[0.5px] border-[var(--border-medium)] hover:border-[var(--border-strong)] shadow-sm";return e.jsxs(m.button,{onClick:f,disabled:a,className:`
        flex items-center justify-center gap-3 h-14 px-6 rounded-2xl
        font-semibold text-base
        transition-all duration-200
        disabled:opacity-50 disabled:cursor-not-allowed
        ${y}
        ${b}
      `,whileHover:{y:-2,scale:1.01},whileTap:{scale:.98},transition:{type:"spring",stiffness:500,damping:30},children:[p(),e.jsx("span",{children:a?"Ouverture...":l})]})}function ue({onNavigate:u,showToast:l,useMockData:v=!1,data:s}){var P,z,R,$;const{userProfile:x}=F(),[t,b]=o.useState(null),[a,h]=o.useState(null),[f,p]=o.useState([]),[y,d]=o.useState(!0),[c,g]=o.useState(""),[_,W]=o.useState(!1),{notification:w}=D(),{play:k}=O();o.useEffect(()=>{if(v){const r=G[0];h(r),p(r.attendees||[]),d(!1)}else s!=null&&s.sessionId&&U()},[s==null?void 0:s.sessionId,v]);const U=async()=>{var r,n;if(!(s!=null&&s.sessionId)){l("Aucune session spÃ©cifiÃ©e","error"),d(!1);return}try{const j=(r=(await S.getSessions()).sessions)==null?void 0:r.find(I=>I.id===s.sessionId);if(!j){l("Session non trouvÃ©e","error"),d(!1);return}h(j);const B=await S.getCheckIns(s.sessionId);p(B.checkIns||[]);const H=(n=B.checkIns)==null?void 0:n.find(I=>I.userId===(x==null?void 0:x.id));H&&b(H.status),d(!1)}catch(i){console.error("Error loading session:",i),l(i.message||"Erreur de chargement","error"),d(!1)}},C=async r=>{if(r==="late"&&!c){l("Indiquez votre retard estimÃ©","error");return}if(!a||!(s!=null&&s.sessionId)){l("Session non disponible","error");return}try{const n=r==="late"?`${c} min de retard`:"";await S.checkIn(s.sessionId,r,n),b(r),r==="present"?(w("success"),k("success"),W(!0),l("âœ… PrÃ©sence confirmÃ©e ! +1 fiabilitÃ©","success")):r==="late"?(l(`â° Retard signalÃ© : ${c} min`,"info"),w("warning"),k("whoosh")):(l("âŒ Absence signalÃ©e (score impactÃ©)","error"),w("error"),k("error")),setTimeout(()=>{u("squad-detail",{id:a.squadId||(s==null?void 0:s.squadId)})},r==="present"?2500:1500)}catch(n){console.error("Check-in error:",n),l(n.message||"Erreur lors du check-in","error")}};if(y)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[var(--primary-500)] mx-auto mb-4"}),e.jsx("p",{className:"text-[var(--fg-secondary)]",children:"Chargement..."})]})});if(!a)return e.jsx("div",{className:"min-h-screen flex items-center justify-center px-4",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("div",{className:"w-16 h-16 bg-[var(--error-50)] rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Z,{className:"w-8 h-8 text-[var(--error-500)]"})}),e.jsx("h2",{className:"text-xl font-semibold text-[var(--fg-primary)] mb-2",children:"Session introuvable"}),e.jsx("p",{className:"text-[var(--fg-secondary)] mb-6",children:"Cette session n'existe pas ou a Ã©tÃ© supprimÃ©e."}),e.jsx(J,{onClick:()=>u("home"),children:"Retour Ã  l'accueil"})]})});const L=f.filter(r=>r.status==="present").length,A=f.filter(r=>r.status==="late").length,V=((z=(P=a.confirmedSlot)==null?void 0:P.responses)==null?void 0:z.filter(r=>r.response==="yes").length)||0;return e.jsx("div",{className:"min-h-screen pb-24 pt-safe",children:e.jsxs("div",{className:"px-4 py-8 max-w-2xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[e.jsx("button",{onClick:()=>u("squad-detail",{id:a.squadId||(s==null?void 0:s.squadId)}),className:"w-12 h-12 rounded-2xl bg-white border-[0.5px] border-[var(--border-medium)] flex items-center justify-center hover:border-[var(--border-strong)] shadow-sm transition-all",children:e.jsx(ee,{className:"w-5 h-5 text-[var(--fg-primary)]",strokeWidth:2})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-2xl font-semibold text-[var(--fg-primary)] tracking-tight",children:"Check-in session"}),e.jsx("div",{className:"text-sm text-[var(--fg-tertiary)] font-medium mt-0.5",children:a.squadName})]})]}),e.jsxs(m.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-gradient-to-br from-[var(--primary-50)] to-[var(--warning-50)] rounded-2xl p-6 mb-8 border-[0.5px] border-[var(--primary-200)] shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl bg-[var(--primary-500)] flex items-center justify-center",children:e.jsx(N,{className:"w-7 h-7 text-white",strokeWidth:2})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-[var(--fg-tertiary)] font-medium mb-1",children:"C'est l'heure !"}),e.jsx("div",{className:"text-2xl font-bold text-[var(--fg-primary)]",children:a.time})]})]}),e.jsx("p",{className:"text-sm text-[var(--fg-secondary)] font-medium",children:"Confirmez votre prÃ©sence pour que l'Ã©quipe sache que vous Ãªtes prÃªt."})]}),e.jsxs("div",{className:"bg-white rounded-2xl overflow-hidden border-[0.5px] border-[var(--border-subtle)] shadow-md mb-8",children:[e.jsxs("div",{className:"relative h-32",children:[e.jsx(X,{src:a.gameImage,alt:a.game,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-black/30 to-transparent"}),e.jsxs("div",{className:"absolute bottom-4 left-4",children:[e.jsx("div",{className:"text-xs text-white/70 font-medium mb-1",children:a.game}),e.jsx("div",{className:"text-xl font-bold text-white",children:a.title})]})]}),e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs("div",{className:"flex-1 bg-[var(--success-50)] rounded-xl px-3 py-2 border-[0.5px] border-[var(--success-200)]",children:[e.jsx("div",{className:"text-xs text-[var(--success-700)] font-medium mb-1",children:"PrÃ©sents"}),e.jsx("div",{className:"text-lg font-bold text-[var(--success-600)]",children:L})]}),e.jsxs("div",{className:"flex-1 bg-[var(--warning-50)] rounded-xl px-3 py-2 border-[0.5px] border-[var(--warning-200)]",children:[e.jsx("div",{className:"text-xs text-[var(--warning-700)] font-medium mb-1",children:"En retard"}),e.jsx("div",{className:"text-lg font-bold text-[var(--warning-600)]",children:A})]}),e.jsxs("div",{className:"flex-1 bg-[var(--bg-subtle)] rounded-xl px-3 py-2 border-[0.5px] border-[var(--border-medium)]",children:[e.jsx("div",{className:"text-xs text-[var(--fg-tertiary)] font-medium mb-1",children:"En attente"}),e.jsx("div",{className:"text-lg font-bold text-[var(--fg-secondary)]",children:V-L-A})]})]}),e.jsx("div",{className:"space-y-2",children:($=(R=a.confirmedSlot)==null?void 0:R.responses)==null?void 0:$.map(r=>{const n=r.player,i=f.find(j=>j.userId===n.id);return e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-[var(--border-subtle)] last:border-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:n.avatar,alt:n.name,className:"w-9 h-9 rounded-full"}),e.jsx("div",{className:"text-sm font-semibold text-[var(--fg-primary)]",children:n.name})]}),e.jsxs("div",{children:[(i==null?void 0:i.status)==="present"&&e.jsxs("div",{className:"flex items-center gap-1.5 bg-[var(--success-50)] px-2.5 py-1 rounded-full",children:[e.jsx(E,{className:"w-3.5 h-3.5 text-[var(--success-600)]",strokeWidth:2}),e.jsx("span",{className:"text-xs font-semibold text-[var(--success-700)]",children:"PrÃ©sent"})]}),(i==null?void 0:i.status)==="late"&&e.jsxs("div",{className:"flex items-center gap-1.5 bg-[var(--warning-50)] px-2.5 py-1 rounded-full",children:[e.jsx(N,{className:"w-3.5 h-3.5 text-[var(--warning-600)]",strokeWidth:2}),e.jsxs("span",{className:"text-xs font-semibold text-[var(--warning-700)]",children:["+",i.note,"min"]})]}),(i==null?void 0:i.status)==="absent"&&e.jsxs("div",{className:"flex items-center gap-1.5 bg-[var(--bg-subtle)] px-2.5 py-1 rounded-full",children:[e.jsx(q,{className:"w-3.5 h-3.5 text-[var(--danger-600)]",strokeWidth:2}),e.jsx("span",{className:"text-xs font-semibold text-[var(--danger-700)]",children:"Absent"})]}),!i&&e.jsxs("div",{className:"flex items-center gap-1.5 bg-[var(--bg-subtle)] px-2.5 py-1 rounded-full",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-[var(--fg-tertiary)] animate-pulse"}),e.jsx("span",{className:"text-xs font-semibold text-[var(--fg-tertiary)]",children:"En attente"})]})]})]},n.id)})})]})]}),!t&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-[var(--fg-primary)] mb-4",children:"Confirmez votre prÃ©sence"}),e.jsx(m.button,{onClick:()=>C("present"),className:"w-full bg-[var(--success-500)] hover:bg-[var(--success-600)] text-white rounded-2xl p-5 shadow-md hover:shadow-lg transition-all",whileHover:{y:-2},whileTap:{scale:.98},children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center",children:e.jsx(E,{className:"w-6 h-6",strokeWidth:2})}),e.jsxs("div",{className:"text-left flex-1",children:[e.jsx("div",{className:"text-base font-bold mb-1",children:"Je suis lÃ "}),e.jsx("div",{className:"text-sm text-white/80 font-medium",children:"PrÃªt Ã  jouer maintenant"})]})]})}),e.jsxs(m.div,{className:"bg-white rounded-2xl p-5 border-[0.5px] border-[var(--border-subtle)] shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-[var(--warning-50)] flex items-center justify-center",children:e.jsx(N,{className:"w-6 h-6 text-[var(--warning-600)]",strokeWidth:2})}),e.jsxs("div",{className:"text-left flex-1",children:[e.jsx("div",{className:"text-base font-bold text-[var(--fg-primary)] mb-1",children:"Je suis en retard"}),e.jsx("div",{className:"text-sm text-[var(--fg-tertiary)] font-medium",children:"Indiquez votre retard estimÃ©"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",value:c,onChange:r=>g(r.target.value),placeholder:"Minutes",min:"5",max:"60",className:"flex-1 h-11 bg-[var(--bg-base)] border-[0.5px] border-[var(--border-medium)] rounded-xl px-4 text-sm text-[var(--fg-primary)] font-semibold focus:border-[var(--warning-500)] focus:ring-2 focus:ring-[var(--warning-500)]/20"}),e.jsx(J,{variant:"ghost",onClick:()=>C("late"),disabled:!c,className:"h-11 px-5 bg-[var(--warning-500)] hover:bg-[var(--warning-600)] text-white rounded-xl font-semibold disabled:opacity-40",children:"Confirmer"})]})]}),e.jsx(m.button,{onClick:()=>C("absent"),className:"w-full bg-white hover:bg-[var(--danger-50)] border-[0.5px] border-[var(--border-medium)] hover:border-[var(--danger-500)] text-[var(--fg-primary)] rounded-2xl p-5 shadow-sm hover:shadow-md transition-all",whileHover:{y:-2},whileTap:{scale:.98},children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-[var(--danger-50)] flex items-center justify-center",children:e.jsx(q,{className:"w-6 h-6 text-[var(--danger-600)]",strokeWidth:2})}),e.jsxs("div",{className:"text-left flex-1",children:[e.jsx("div",{className:"text-base font-bold mb-1",children:"Je ne viens pas"}),e.jsx("div",{className:"text-sm text-[var(--fg-tertiary)] font-medium",children:"âš ï¸ Votre score de fiabilitÃ© sera impactÃ©"})]})]})})]}),t&&e.jsxs(e.Fragment,{children:[e.jsx(m.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:`rounded-2xl p-6 shadow-lg mb-6 ${t==="present"?"bg-[var(--success-50)] border-[0.5px] border-[var(--success-200)]":t==="late"?"bg-[var(--warning-50)] border-[0.5px] border-[var(--warning-200)]":"bg-[var(--danger-50)] border-[0.5px] border-[var(--danger-200)]"}`,children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`w-16 h-16 rounded-3xl flex items-center justify-center mx-auto mb-4 ${t==="present"?"bg-[var(--success-500)]":t==="late"?"bg-[var(--warning-500)]":"bg-[var(--danger-500)]"}`,children:[t==="present"&&e.jsx(E,{className:"w-8 h-8 text-white",strokeWidth:2}),t==="late"&&e.jsx(N,{className:"w-8 h-8 text-white",strokeWidth:2}),t==="absent"&&e.jsx(q,{className:"w-8 h-8 text-white",strokeWidth:2})]}),e.jsxs("h3",{className:"text-xl font-bold text-[var(--fg-primary)] mb-2",children:[t==="present"&&"PrÃ©sence confirmÃ©e !",t==="late"&&"Retard signalÃ©",t==="absent"&&"Absence enregistrÃ©e"]}),e.jsxs("p",{className:"text-sm text-[var(--fg-tertiary)] font-medium",children:[t==="present"&&"Amusez-vous bien ! ðŸŽ®",t==="late"&&"L'Ã©quipe est prÃ©venue de votre retard",t==="absent"&&"Dommage... Ã€ la prochaine !"]})]})}),t==="present"&&e.jsxs(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-[var(--fg-secondary)] mb-3",children:"Lancer le jeu"}),e.jsx(M,{type:"game",label:"Lancer Valorant",deepLink:"valorant://",fallbackUrl:"https://playvalorant.com",variant:"primary"}),e.jsx(M,{type:"discord",label:"Rejoindre le vocal",deepLink:"discord://channels/1234567890",fallbackUrl:"https://discord.gg/squad",variant:"secondary"})]})]}),_&&e.jsx(T,{title:"PrÃ©sence confirmÃ©e !",subtitle:"Ton Ã©quipe sait que tu es prÃªt. Let's go !",variant:"success",onComplete:()=>W(!1)})]})})}export{ue as CheckInScreen,ue as default};
