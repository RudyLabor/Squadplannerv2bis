import{J as k,r as i,$ as v,j as e,K as m,m as C,Y as A,E as M,B as W,H as $}from"./index-D_HhqbxM.js";import{A as _}from"./arrow-left-CFku1NrH.js";function S({onNavigate:p,showToast:x}){const{user:t}=k(),[h,n]=i.useState([]),[b,f]=i.useState(!0),[o,c]=i.useState(0);i.useEffect(()=>{g()},[t==null?void 0:t.id]);const g=async()=>{if(t!=null&&t.id){f(!0);try{const r=await v.getUserNotifications(t.id);n(r.notifications||[]),c(r.unreadCount||0)}catch(r){console.error("Load notifications error:",r),n([]),c(0)}finally{f(!1)}}},j=async r=>{try{await v.markAsRead(r),n(s=>s.map(a=>a.id===r?{...a,read:!0}:a)),c(s=>Math.max(0,s-1)),x("Notification marquée comme lue","success")}catch(s){console.error("Mark as read error:",s),x(s.message||"Erreur","error")}},y=r=>{switch(r){case"session_confirmed":return e.jsx($,{className:"w-5 h-5 text-[var(--success-500)]",strokeWidth:2});case"reminder_24h":case"reminder_1h":return e.jsx(W,{className:"w-5 h-5 text-[var(--warning-500)]",strokeWidth:2});case"new_vote":return e.jsx(m,{className:"w-5 h-5 text-[var(--primary-500)]",strokeWidth:2});case"badge_unlocked":return e.jsx(M,{className:"w-5 h-5 text-[var(--warning-500)]",strokeWidth:2});case"no_show":return e.jsx(A,{className:"w-5 h-5 text-[var(--error-500)]",strokeWidth:2});default:return e.jsx(m,{className:"w-5 h-5 text-[var(--fg-tertiary)]",strokeWidth:2})}},N=r=>{const s=new Date(r),d=new Date().getTime()-s.getTime(),l=Math.floor(d/(1e3*60)),u=Math.floor(d/(1e3*60*60)),w=Math.floor(d/(1e3*60*60*24));return l<1?"À l'instant":l<60?`Il y a ${l}min`:u<24?`Il y a ${u}h`:`Il y a ${w}j`};return e.jsx("div",{className:"min-h-screen pb-24 pt-safe bg-[var(--bg-base)]",children:e.jsxs("div",{className:"px-4 py-8 max-w-2xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[e.jsx("button",{onClick:()=>p("home"),className:"w-10 h-10 rounded-xl bg-white border-[0.5px] border-[var(--border-medium)] hover:border-[var(--border-strong)] flex items-center justify-center shadow-sm transition-all duration-200",children:e.jsx(_,{className:"w-5 h-5 text-[var(--fg-secondary)]",strokeWidth:2})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-2xl font-semibold text-[var(--fg-primary)] tracking-tight",children:"Notifications"}),o>0&&e.jsxs("p",{className:"text-sm text-[var(--primary-500)] mt-1 font-semibold",children:[o," non lue",o>1?"s":""]})]})]}),b?e.jsx("div",{className:"text-center py-12",children:e.jsxs("div",{className:"inline-flex items-center gap-2 text-[var(--fg-tertiary)]",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-[var(--primary-500)] border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Chargement..."})]})}):h.length===0?e.jsxs("div",{className:"bg-white rounded-2xl p-8 border-[0.5px] border-[var(--border-subtle)] shadow-sm text-center",children:[e.jsx(m,{className:"w-12 h-12 text-[var(--fg-tertiary)] mx-auto mb-4",strokeWidth:1.5}),e.jsx("p",{className:"text-sm text-[var(--fg-secondary)] mb-2",children:"Aucune notification"}),e.jsx("p",{className:"text-xs text-[var(--fg-tertiary)]",children:"Vous recevrez des notifications pour vos sessions et badges"})]}):e.jsx("div",{className:"space-y-3",children:h.map((r,s)=>e.jsx(C.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:s*.05},className:`bg-white rounded-2xl p-4 border-[0.5px] ${r.read?"border-[var(--border-subtle)]":"border-[var(--primary-200)] bg-gradient-to-br from-[var(--primary-50)] to-white"} shadow-sm hover:shadow-md transition-all duration-200`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0 ${r.read?"bg-[var(--bg-subtle)]":"bg-white"}`,children:y(r.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-1",children:[e.jsx("h3",{className:`text-sm font-semibold ${r.read?"text-[var(--fg-secondary)]":"text-[var(--fg-primary)]"}`,children:r.title}),e.jsx("span",{className:"text-xs text-[var(--fg-tertiary)] whitespace-nowrap",children:N(r.createdAt)})]}),e.jsx("p",{className:"text-xs text-[var(--fg-tertiary)] mb-3",children:r.message}),!r.read&&e.jsx("button",{onClick:()=>j(r.id),className:"text-xs font-semibold text-[var(--primary-500)] hover:text-[var(--primary-600)] transition-colors",children:"Marquer comme lue"})]})]})},r.id))})]})})}export{S as NotificationsScreen,S as default};
