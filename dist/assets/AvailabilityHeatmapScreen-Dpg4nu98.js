import{r as c,z as q,j as e,T as E,m as H}from"./index-D_HhqbxM.js";import{A as $}from"./arrow-left-CFku1NrH.js";function I({onNavigate:f,showToast:j,data:t,useMockData:p=!1}){const[y,o]=c.useState([]),[N,h]=c.useState(!0),[d,v]=c.useState(0),[L,w]=c.useState(null),g=["Dim","Lun","Mar","Mer","Jeu","Ven","Sam"],A=Array.from({length:24},(r,s)=>`${String(s).padStart(2,"0")}h`);c.useEffect(()=>{S()},[t==null?void 0:t.squadId]);const S=async()=>{if(!(!(t!=null&&t.squadId)&&!p)){h(!0);try{if(p){await new Promise(s=>setTimeout(s,1500));const r=Array(7).fill(null).map(()=>Array(24).fill(0).map(()=>{const s=Math.random();return s>.8?Math.floor(Math.random()*25)+75:s>.6?Math.floor(Math.random()*25)+50:s>.4?Math.floor(Math.random()*25)+25:s>.2?Math.floor(Math.random()*25):0}));o(r),v(42)}else{const{sessions:r}=await q.getSessions(t==null?void 0:t.squadId),s=Array(7).fill(null).map(()=>Array(24).fill(0));let n=0;r.forEach(i=>{var b;if(i.status!=="confirmed")return;const a=i.slots.find(u=>u.id===i.selectedSlotId);if(!a)return;const l=new Date(`${a.date}T${a.time}:00`),m=l.getDay(),x=l.getHours(),k=(((b=a.responses)==null?void 0:b.filter(u=>u.response==="yes").length)||0)/(i.playersNeeded||5);s[m][x]+=k*25,s[m][x]>100&&(s[m][x]=100),n++}),o(s),v(n)}}catch(r){console.error("Load heatmap error:",r),j(r.message||"Erreur lors du chargement de la heatmap","error"),o(Array(7).fill(null).map(()=>Array(24).fill(0)))}finally{h(!1)}}},C=r=>r===0?"bg-[var(--bg-subtle)]":r<25?"bg-[var(--error-100)]":r<50?"bg-[var(--warning-200)]":r<75?"bg-[var(--success-200)]":"bg-[var(--success-500)]",M=(r,s,n)=>{n>0&&(w({day:r,hour:s}),f("create-session",{squadId:t==null?void 0:t.squadId,prefilledDay:r,prefilledTime:`${String(s).padStart(2,"0")}:00`}))};return e.jsx("div",{className:"min-h-screen pb-24 pt-safe bg-[var(--bg-base)]",children:e.jsxs("div",{className:"px-4 py-8 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[e.jsx("button",{onClick:()=>f("home"),className:"w-10 h-10 rounded-xl bg-white border-[0.5px] border-[var(--border-medium)] hover:border-[var(--border-strong)] flex items-center justify-center shadow-sm transition-all duration-200",children:e.jsx($,{className:"w-5 h-5 text-[var(--fg-secondary)]",strokeWidth:2})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-[var(--fg-primary)] tracking-tight",children:"Heatmap de DisponibilitÃ©"}),e.jsxs("p",{className:"text-sm text-[var(--fg-tertiary)] mt-1",children:[d," session",d>1?"s":""," analysÃ©e",d>1?"s":""]})]})]}),N?e.jsx("div",{className:"text-center py-12",children:e.jsxs("div",{className:"inline-flex items-center gap-2 text-[var(--fg-tertiary)]",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-[var(--primary-500)] border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Analyse en cours..."})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-gradient-to-br from-[var(--primary-50)] to-[var(--secondary-50)] rounded-2xl p-5 mb-6 border-[0.5px] border-[var(--primary-200)]",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(E,{className:"w-5 h-5 text-[var(--primary-500)] flex-shrink-0 mt-0.5",strokeWidth:2}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-[var(--fg-primary)] mb-1",children:"ğŸ“Š Visualisation des CrÃ©neaux Efficaces"}),e.jsx("p",{className:"text-xs text-[var(--fg-tertiary)]",children:"Les cases vertes = crÃ©neaux avec forte participation. Cliquez pour crÃ©er une session."})]})]})}),e.jsxs("div",{className:"flex items-center justify-center gap-6 mb-6 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-[var(--bg-subtle)]"}),e.jsx("span",{className:"text-[var(--fg-tertiary)]",children:"Aucune"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-[var(--error-100)]"}),e.jsx("span",{className:"text-[var(--fg-tertiary)]",children:"Faible"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-[var(--warning-200)]"}),e.jsx("span",{className:"text-[var(--fg-tertiary)]",children:"Moyen"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-[var(--success-200)]"}),e.jsx("span",{className:"text-[var(--fg-tertiary)]",children:"Bon"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-[var(--success-500)]"}),e.jsx("span",{className:"text-[var(--fg-tertiary)]",children:"Excellent"})]})]}),e.jsx("div",{className:"bg-white rounded-2xl p-6 border-[0.5px] border-[var(--border-subtle)] shadow-sm overflow-x-auto",children:e.jsxs("div",{className:"min-w-[600px]",children:[e.jsxs("div",{className:"grid grid-cols-[auto_repeat(7,1fr)] gap-1 mb-1",children:[e.jsx("div",{className:"w-12"}),g.map((r,s)=>e.jsx("div",{className:"text-center text-xs font-semibold text-[var(--fg-secondary)] py-2",children:r},s))]}),A.map((r,s)=>e.jsxs("div",{className:"grid grid-cols-[auto_repeat(7,1fr)] gap-1 mb-1",children:[e.jsx("div",{className:"w-12 flex items-center justify-end pr-2 text-xs text-[var(--fg-tertiary)]",children:r}),g.map((n,i)=>{var l;const a=((l=y[i])==null?void 0:l[s])||0;return e.jsx(H.button,{onClick:()=>M(i,s,a),whileHover:{scale:a>0?1.1:1},whileTap:{scale:a>0?.95:1},className:`aspect-square rounded ${C(a)} ${a>0?"cursor-pointer hover:ring-2 hover:ring-[var(--primary-500)]":"cursor-default"} transition-all duration-150`,title:a>0?`${a}% d'efficacitÃ©`:"Aucune donnÃ©e"},i)})]},s))]})}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("p",{className:"text-xs text-[var(--fg-tertiary)]",children:"ğŸ’¡ Les donnÃ©es sont basÃ©es sur les sessions confirmÃ©es avec plus de 70% de participation"})})]})]})})}export{I as AvailabilityHeatmapScreen,I as default};
